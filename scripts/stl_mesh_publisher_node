#!/usr/bin/env python
import rospy
import ros_helper.msgs_api.visualization as vis

class MeshPublisher(object):

    def __init__(self, filename, topic_name, frame_id, scale, color):

        # Set vars
        self.filename = filename
        self.frame_id = frame_id
        self.scale = scale
        self.color = color

        # Setup ros publisher
        self.pub = rospy.Publisher(topic_name, vis.Marker, queue_size=1)

    def update(self, event):
        self.pub.publish(vis.StlMeshMsg(self.filename, rospy.Time.now(), self.frame_id, self.scale, self.color))

if __name__=='__main__':

    # Init node
    rospy.init_node('mesh_publisher_node')

    # Grab required parameters
    filename = rospy.get_param('~filename')
    topic_name = rospy.get_param('~topic_name')
    frame_id = rospy.get_param('~frame_id')
    scale = rospy.get_param('~scale')
    color = rospy.get_param('~color')

    # Setup timer and spin
    rospy.Timer(rospy.Duration(1.0/50.0), MeshPublisher(filename, topic_name, frame_id, scale, color).update)
    rospy.spin()
    
                
